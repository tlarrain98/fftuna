{"ast":null,"code":"/**\n * Module dependencies.\n */\nvar pause = require('pause'),\n    util = require('util'),\n    Strategy = require('passport-strategy');\n/**\n * `SessionStrategy` constructor.\n *\n * @api public\n */\n\n\nfunction SessionStrategy() {\n  Strategy.call(this);\n  this.name = 'session';\n}\n/**\n * Inherit from `Strategy`.\n */\n\n\nutil.inherits(SessionStrategy, Strategy);\n/**\n * Authenticate request based on the current session state.\n *\n * The session authentication strategy uses the session to restore any login\n * state across requests.  If a login session has been established, `req.user`\n * will be populated with the current user.\n *\n * This strategy is registered automatically by Passport.\n *\n * @param {Object} req\n * @param {Object} options\n * @api protected\n */\n\nSessionStrategy.prototype.authenticate = function (req, options) {\n  if (!req._passport) {\n    return this.error(new Error('passport.initialize() middleware not in use'));\n  }\n\n  options = options || {};\n  var self = this,\n      su;\n\n  if (req._passport.session) {\n    su = req._passport.session.user;\n  }\n\n  if (su || su === 0) {\n    // NOTE: Stream pausing is desirable in the case where later middleware is\n    //       listening for events emitted from request.  For discussion on the\n    //       matter, refer to: https://github.com/jaredhanson/passport/pull/106\n    var paused = options.pauseStream ? pause(req) : null;\n\n    req._passport.instance.deserializeUser(su, req, function (err, user) {\n      if (err) {\n        return self.error(err);\n      }\n\n      if (!user) {\n        delete req._passport.session.user;\n        self.pass();\n\n        if (paused) {\n          paused.resume();\n        }\n\n        return;\n      }\n\n      var property = req._passport.instance._userProperty || 'user';\n      req[property] = user;\n      self.pass();\n\n      if (paused) {\n        paused.resume();\n      }\n    });\n  } else {\n    self.pass();\n  }\n};\n/**\n * Expose `SessionStrategy`.\n */\n\n\nmodule.exports = SessionStrategy;","map":{"version":3,"sources":["C:/Users/tlarr/ffwebsite/node_modules/passport/lib/strategies/session.js"],"names":["pause","require","util","Strategy","SessionStrategy","call","name","inherits","prototype","authenticate","req","options","_passport","error","Error","self","su","session","user","paused","pauseStream","instance","deserializeUser","err","pass","resume","property","_userProperty","module","exports"],"mappings":"AAAA;;;AAGA,IAAIA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAAnB;AAAA,IACIC,IAAI,GAAGD,OAAO,CAAC,MAAD,CADlB;AAAA,IAEIE,QAAQ,GAAGF,OAAO,CAAC,mBAAD,CAFtB;AAKA;;;;;;;AAKA,SAASG,eAAT,GAA2B;AACzBD,EAAAA,QAAQ,CAACE,IAAT,CAAc,IAAd;AACA,OAAKC,IAAL,GAAY,SAAZ;AACD;AAED;;;;;AAGAJ,IAAI,CAACK,QAAL,CAAcH,eAAd,EAA+BD,QAA/B;AAEA;;;;;;;;;;;;;;AAaAC,eAAe,CAACI,SAAhB,CAA0BC,YAA1B,GAAyC,UAASC,GAAT,EAAcC,OAAd,EAAuB;AAC9D,MAAI,CAACD,GAAG,CAACE,SAAT,EAAoB;AAAE,WAAO,KAAKC,KAAL,CAAW,IAAIC,KAAJ,CAAU,6CAAV,CAAX,CAAP;AAA8E;;AACpGH,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AAEA,MAAII,IAAI,GAAG,IAAX;AAAA,MACIC,EADJ;;AAEA,MAAIN,GAAG,CAACE,SAAJ,CAAcK,OAAlB,EAA2B;AACzBD,IAAAA,EAAE,GAAGN,GAAG,CAACE,SAAJ,CAAcK,OAAd,CAAsBC,IAA3B;AACD;;AAED,MAAIF,EAAE,IAAIA,EAAE,KAAK,CAAjB,EAAoB;AAClB;AACA;AACA;AAEA,QAAIG,MAAM,GAAGR,OAAO,CAACS,WAAR,GAAsBpB,KAAK,CAACU,GAAD,CAA3B,GAAmC,IAAhD;;AACAA,IAAAA,GAAG,CAACE,SAAJ,CAAcS,QAAd,CAAuBC,eAAvB,CAAuCN,EAAvC,EAA2CN,GAA3C,EAAgD,UAASa,GAAT,EAAcL,IAAd,EAAoB;AAClE,UAAIK,GAAJ,EAAS;AAAE,eAAOR,IAAI,CAACF,KAAL,CAAWU,GAAX,CAAP;AAAyB;;AACpC,UAAI,CAACL,IAAL,EAAW;AACT,eAAOR,GAAG,CAACE,SAAJ,CAAcK,OAAd,CAAsBC,IAA7B;AACAH,QAAAA,IAAI,CAACS,IAAL;;AACA,YAAIL,MAAJ,EAAY;AACVA,UAAAA,MAAM,CAACM,MAAP;AACD;;AACD;AACD;;AACD,UAAIC,QAAQ,GAAGhB,GAAG,CAACE,SAAJ,CAAcS,QAAd,CAAuBM,aAAvB,IAAwC,MAAvD;AACAjB,MAAAA,GAAG,CAACgB,QAAD,CAAH,GAAgBR,IAAhB;AACAH,MAAAA,IAAI,CAACS,IAAL;;AACA,UAAIL,MAAJ,EAAY;AACVA,QAAAA,MAAM,CAACM,MAAP;AACD;AACF,KAhBD;AAiBD,GAvBD,MAuBO;AACLV,IAAAA,IAAI,CAACS,IAAL;AACD;AACF,CApCD;AAuCA;;;;;AAGAI,MAAM,CAACC,OAAP,GAAiBzB,eAAjB","sourcesContent":["/**\n * Module dependencies.\n */\nvar pause = require('pause')\n  , util = require('util')\n  , Strategy = require('passport-strategy');\n\n\n/**\n * `SessionStrategy` constructor.\n *\n * @api public\n */\nfunction SessionStrategy() {\n  Strategy.call(this);\n  this.name = 'session';\n}\n\n/**\n * Inherit from `Strategy`.\n */\nutil.inherits(SessionStrategy, Strategy);\n\n/**\n * Authenticate request based on the current session state.\n *\n * The session authentication strategy uses the session to restore any login\n * state across requests.  If a login session has been established, `req.user`\n * will be populated with the current user.\n *\n * This strategy is registered automatically by Passport.\n *\n * @param {Object} req\n * @param {Object} options\n * @api protected\n */\nSessionStrategy.prototype.authenticate = function(req, options) {\n  if (!req._passport) { return this.error(new Error('passport.initialize() middleware not in use')); }\n  options = options || {};\n\n  var self = this, \n      su;\n  if (req._passport.session) {\n    su = req._passport.session.user;\n  }\n\n  if (su || su === 0) {\n    // NOTE: Stream pausing is desirable in the case where later middleware is\n    //       listening for events emitted from request.  For discussion on the\n    //       matter, refer to: https://github.com/jaredhanson/passport/pull/106\n    \n    var paused = options.pauseStream ? pause(req) : null;\n    req._passport.instance.deserializeUser(su, req, function(err, user) {\n      if (err) { return self.error(err); }\n      if (!user) {\n        delete req._passport.session.user;\n        self.pass();\n        if (paused) {\n          paused.resume();\n        }\n        return;\n      }\n      var property = req._passport.instance._userProperty || 'user';\n      req[property] = user;\n      self.pass();\n      if (paused) {\n        paused.resume();\n      }\n    });\n  } else {\n    self.pass();\n  }\n};\n\n\n/**\n * Expose `SessionStrategy`.\n */\nmodule.exports = SessionStrategy;\n"]},"metadata":{},"sourceType":"script"}